Fluentbit và Fluentd là hai công cụ thu thập log được Hosted bởi CNCF, Về cơ bản thì cả 2 công cụ này đều thiên về xử lý Log và qua quá trình sử dụng, mình thấy nó khá là nhẹ và dễ cấu hình, đầu tiên thì mình sử dụng Fluentd, log chủ yếu là cào từ các file log dưới host, Fluentd input cấu hình khá là dễ dàng, kiến trúc của Fluentd đó là Data Collection và Data Aggregration / Processing, từ Data Collection sẽ thực hiện các rule input chính là đọc và cào log từ các file ở host, sau đó sẽ cấu hình rule để forward tới Data Aggregration, cũng là Fluentd nhưng instance này sẽ cấu hình output tới elasticsearch và ta sẽ viết thêm các filter để biến tấu log như xóa một vài key, filter bỏ các log health-check đi chẳng hạn. Fluentd được viết bằng Ruby, giống với Logstash, tuy nhiên khi show pod của nó lên thì mình vẫn thấy nó chiếm kha khá RAM/CPU, sau đó mình search và chạy thử Fluentbit, ấn tượng đầu tiên đó là số RAM cực kỳ thấp, nó được viết bằng C và compile ra binary thay vì chạy biên dịch như Ruby nên phải nói là siêu nhẹ, min chỉ có 4 Mb trong khi đó Fluentd lên tới 64-128 Mb. Input của Fluentbit cũng đa dạng hơn. Tuy nhiên phần Data Aggregration lại không được "ngon" cho lắm và không hỗ trợ tốt json hoặc key.value dạng nested nên filter hơi chuối, tuy nhiên Data Aggregration chỉ cần một đến 2 instance chính và có thể autoscale nên không quan trọng về performance nên vẫn có thể dùng Fluentd được, với ưu thế của thư viện các ngôn ngữ thông dịch thì khả năng xử lý dữ liệu như json dễ hơn và ít gặp vấn đề hơn, thậm chí có thể dùng trực tiếp một số hàm hoặc thư viện của Ruby để filter/process các Events. Vì vậy cách tốt nhất và đúng với tiêu chí của việc tạo Fluentd và Fluentbit đó là để Fluentbit làm DataCollection, Fluentd thì làm forwarder server (Data Aggregation/Procesing).

Ưu điểm:
Cực nhẹ, fluentbit chỉ chạy có vài MB và craw cực nhanh.
Dễ cấu hình, cộng đồng support tốt, là project đạt được Graduated of CNCF, mặc dù có khá là ít các lập trình viên contribute vào project này.
Chạy ổn định trên Kubernetes, với Fluentbit ta nên dùng image và chart của bitnami vì Fluentbit nếu chạy ở dạng Pod và craw log dưới host thì sẽ có một vài quyền hơi đặc biệt, ví dụ Hostpath, mà đã liên quan tới Host thì chạy Pod rootless là tốt nhất, trong khi image mặc định của Fluent lại luôn là root.
Ảnh dưới là mô hình log EFK thay cho ELK with mixed of Fluentbit + Fluentd
Cấu hình và cài đặt thì dùng helm của bitnami, cài fluentbit trước và cài fluentd sau, trước đó lấy thông tin user / pass của es để add vào fluentd. Cấu hình thì vào trang chủ của helm và bitnami có sẵn file config mà, chỉ việc sửa lại là xong, còn bác muốn step by step thì khó vì app dạng Cloud Native có phải next next như kiểu Windows hoặc gõ đúng command đâu, team e làm cũng giới thiệu như này xong 2 hôm sau lên luôn, trước đó chưa ai dùng nhé :)))
https://www.facebook.com/photo?fbid=2037203659780813&set=gm.1184957142015395
